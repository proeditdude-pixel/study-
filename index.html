<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>SyllabusStudy Pro</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <style>
        :root {
            --bg: #09090b;
            --surface: #18181b;
            --surface-hover: #27272a;
            --primary: #3b82f6;
            --primary-glow: rgba(59, 130, 246, 0.3);
            --text-main: #fafafa;
            --text-sec: #a1a1aa;
            --border: rgba(255,255,255,0.08);
            --danger: #ef4444;
            --radius-lg: 24px;
            --radius-md: 16px;
            --header-h: 200px;
        }

        * { box-sizing: border-box; -webkit-font-smoothing: antialiased; }

        body, html {
            margin: 0; padding: 0;
            background: var(--bg); color: var(--text-main);
            font-family: 'SF Pro Display', -apple-system, system-ui, sans-serif;
            height: 100%; overflow: hidden;
        }

        /* --- Animations --- */
        @keyframes fadeInSlide {
            from { opacity: 0; transform: translateY(10px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .view-animate { animation: fadeInSlide 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; }

        /* --- Layout --- */
        .app-container { position: relative; width: 100%; height: 100%; max-width: 500px; margin: 0 auto; }

        .view {
            position: absolute; inset: 0;
            padding: 20px 20px 120px 20px;
            overflow-y: auto; overflow-x: hidden;
            display: none;
        }

        .view.active { display: block; }

        /* --- Components --- */
        h1 { font-size: 34px; font-weight: 800; letter-spacing: -0.5px; margin-bottom: 8px; }
        
        .card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            padding: 20px;
            margin-bottom: 16px;
            transition: all 0.2s ease;
        }

        .card-press:active { transform: scale(0.97); background: var(--surface-hover); }

        .btn {
            background: var(--primary); color: white;
            border: none; padding: 18px; width: 100%;
            border-radius: var(--radius-md); font-size: 16px; font-weight: 700;
            cursor: pointer; transition: 0.2s;
            display: flex; align-items: center; justify-content: center; gap: 8px;
            box-shadow: 0 4px 15px var(--primary-glow);
        }

        .btn:active { transform: scale(0.96); opacity: 0.9; }
        .btn-sec { background: var(--surface-hover); box-shadow: none; }

        .inp {
            background: var(--surface-hover); border: 1px solid var(--border);
            color: white; padding: 16px; width: 100%;
            border-radius: var(--radius-md); font-size: 16px; outline: none;
            transition: 0.2s;
        }
        .inp:focus { border-color: var(--primary); background: #1f1f23; }

        /* --- Navigation --- */
        .dock {
            position: absolute; bottom: 30px; left: 20px; right: 20px;
            height: 72px; background: rgba(24, 24, 27, 0.8);
            backdrop-filter: blur(24px); -webkit-backdrop-filter: blur(24px);
            border-radius: 36px; border: 1px solid var(--border);
            display: flex; justify-content: space-around; align-items: center;
            z-index: 1000; box-shadow: 0 10px 40px rgba(0,0,0,0.4);
        }

        .dock-item {
            color: var(--text-sec); transition: 0.3s cubic-bezier(0.17, 0.67, 0.83, 0.67);
            flex: 1; display: flex; justify-content: center;
        }

        .dock-item.active { color: var(--primary); transform: translateY(-4px); }
        .dock-item svg { width: 28px; height: 28px; }

        /* --- Profile Hero --- */
        .hero-container { position: relative; margin: -20px -20px 60px -20px; height: var(--header-h); }
        .hero-banner { width: 100%; height: 100%; background: #27272a; overflow: hidden; }
        .hero-banner img { width: 100%; height: 100%; object-fit: cover; }
        
        .hero-avatar {
            position: absolute; bottom: -45px; left: 25px;
            width: 90px; height: 90px; border-radius: 28px;
            border: 6px solid var(--bg); background: var(--surface);
            overflow: hidden; box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }
        .hero-avatar img { width: 100%; height: 100%; object-fit: cover; }

        /* --- Search & Tags --- */
        .badge { font-size: 11px; font-weight: 700; padding: 4px 10px; border-radius: 20px; text-transform: uppercase; }
        .badge-blue { background: var(--primary-glow); color: var(--primary); }

        .empty-state { text-align: center; padding: 60px 20px; color: var(--text-sec); }

        /* --- Modals --- */
        .modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.85);
            backdrop-filter: blur(8px); z-index: 2000;
            display: none; align-items: flex-end; justify-content: center;
        }
        .modal {
            background: var(--surface); width: 100%; max-width: 500px;
            padding: 30px; border-radius: 32px 32px 0 0;
            animation: slideUp 0.3s ease-out;
        }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

        .toast {
            position: fixed; bottom: 120px; left: 50%; transform: translateX(-50%);
            background: #f4f4f5; color: #09090b; padding: 12px 24px;
            border-radius: 50px; font-weight: 600; z-index: 3000;
            opacity: 0; transition: 0.3s; pointer-events: none;
        }
        .toast.show { opacity: 1; transform: translateX(-50%) translateY(-10px); }

    </style>
</head>
<body>

    <div class="app-container">

        <div id="view-home" class="view active">
            <header style="display:flex; justify-content:space-between; align-items:center; margin-bottom:25px;">
                <div>
                    <p style="margin-bottom:4px;">Welcome back,</p>
                    <h1 id="home-user-title">Explorer</h1>
                </div>
                <div onclick="Router.go('settings')" class="card-press" style="background:var(--surface); padding:12px; border-radius:18px;">
                    <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 15a3 3 0 100-6 3 3 0 000 6z"></path><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z"></path></svg>
                </div>
            </header>

            <div id="list-subjects"></div>
            <button class="btn" onclick="Modals.addSubject()">
                <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24"><path d="M12 5v14M5 12h14"></path></svg>
                Create New Table
            </button>
        </div>

        <div id="view-search" class="view">
            <h1>Discovery</h1>
            <p style="margin-bottom:20px;">Find tables from the community.</p>
            
            <div class="search-box" style="position:sticky; top:0; background:var(--bg); padding:10px 0; z-index:10;">
                <input class="inp" placeholder="Search by username..." oninput="Core.search(this.value)">
            </div>

            <div id="list-results" style="margin-top:10px;">
                <div class="empty-state">Type a name to begin searching.</div>
            </div>
        </div>

        <div id="view-profile" class="view" style="padding-top:0;">
            <div class="hero-container">
                <div class="hero-banner" onclick="Core.upload('bnr')">
                    <img id="pf-bnr" src="">
                </div>
                <div class="hero-avatar" onclick="Core.upload('pfp')">
                    <img id="pf-pfp" src="">
                </div>
            </div>
            
            <div class="hero-info" style="margin-top:10px;">
                <h1 id="pf-name">Loading...</h1>
                <span id="pf-badge" class="badge badge-blue">Cloud Account</span>
                
                <div style="margin-top:25px; display:grid; grid-template-columns:1fr 1fr; gap:15px;">
                    <div class="card" style="margin:0; text-align:center;">
                        <span style="display:block; font-size:24px; font-weight:800;" id="stat-tables">0</span>
                        <small style="color:var(--text-sec); text-transform:uppercase; font-size:10px; font-weight:700;">Tables</small>
                    </div>
                    <div class="card" style="margin:0; text-align:center;">
                        <span style="display:block; font-size:24px; font-weight:800;" id="stat-fam">0</span>
                        <small style="color:var(--text-sec); text-transform:uppercase; font-size:10px; font-weight:700;">Connections</small>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-detail" class="view">
            <div onclick="Router.go('home')" style="color:var(--primary); font-weight:700; margin-bottom:20px; display:flex; align-items:center; gap:5px;">
                <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path d="M15 19l-7-7 7-7"></path></svg>
                Back
            </div>
            <h1 id="dt-title">Table Name</h1>
            <p id="dt-desc" style="margin-bottom:25px;"></p>
            
            <div id="list-tasks"></div>
            <button class="btn" onclick="Modals.addTask()">+ Add Goal</button>
        </div>

        <div id="view-settings" class="view">
            <div onclick="Router.go('home')" style="color:var(--primary); font-weight:700; margin-bottom:20px;">‚Üê Back</div>
            <h1>Settings</h1>

            <div class="card card-press" onclick="Router.go('family')">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <div>
                        <b style="display:block;">Family Center</b>
                        <p style="font-size:13px;">Manage shared connections.</p>
                    </div>
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M9 5l7 7-7 7"></path></svg>
                </div>
            </div>

            <div id="auth-section"></div>
            
            <div style="text-align:center; padding:20px; opacity:0.3; font-size:12px;">
                SYLLABUS STUDY PRO v4.1<br>ENGINEERED FOR EXCELLENCE
            </div>
        </div>

        <div id="dock" class="dock">
            <div class="dock-item active" onclick="Router.go('home')">
                <svg fill="currentColor" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
            </div>
            <div class="dock-item" onclick="Router.go('search')">
                <svg fill="currentColor" viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
            </div>
            <div class="dock-item" onclick="Router.go('profile')">
                <svg fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/></svg>
            </div>
        </div>
    </div>

    <div id="modal-overlay" class="modal-overlay" onclick="if(event.target === this) Modals.close()">
        <div class="modal">
            <h2 id="m-title" style="margin-top:0;">Title</h2>
            <div id="m-body"></div>
            <div style="display:flex; gap:12px; margin-top:25px;">
                <button id="m-btn-ok" class="btn">Confirm</button>
                <button class="btn btn-sec" onclick="Modals.close()">Cancel</button>
            </div>
        </div>
    </div>

    <div id="toast" class="toast">Notification</div>
    <input type="file" id="f-upl" hidden onchange="Core.processUpload(this)">

<script>
    // Replace with your actual config
    const CFG = { 
        apiKey: "AIzaSyC2ryrcM8eRTUIkBrVitQUWn2x5oTbbnmE", 
        projectId: "syllabuspro-4ec5c", 
        databaseURL: "https://syllabuspro-4ec5c-default-rtdb.asia-southeast1.firebasedatabase.app/" 
    };
    firebase.initializeApp(CFG);
    const DB = firebase.database();
    
    const State = {
        user: localStorage.getItem('syl_u'),
        pass: localStorage.getItem('syl_p'),
        data: null,
        curSubIdx: 0,
        defaults: {
            bnr: 'https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?w=800',
            pfp: 'https://api.dicebear.com/7.x/avataaars/svg?seed='
        }
    };

    const Router = {
        go: (id) => {
            const views = document.querySelectorAll('.view');
            const docks = document.querySelectorAll('.dock-item');
            
            views.forEach(v => {
                v.classList.remove('active', 'view-animate');
                if(v.id === 'view-' + id) {
                    v.classList.add('active', 'view-animate');
                }
            });

            // Handle Dock highlights
            const navIndex = ['home', 'search', 'profile'].indexOf(id);
            if(navIndex > -1) {
                docks.forEach(d => d.classList.remove('active'));
                docks[navIndex].classList.add('active');
                document.getElementById('dock').style.display = 'flex';
            } else {
                document.getElementById('dock').style.display = 'none';
            }
        }
    };

    const Core = {
        init: () => {
            if(State.user) {
                DB.ref('users/'+State.user).on('value', snap => {
                    const val = snap.val();
                    if(val && val.pass === State.pass) {
                        State.data = val;
                        Core.render();
                    }
                });
            } else {
                const local = localStorage.getItem('syl_local');
                State.data = local ? JSON.parse(local) : { subjects:[], user:'Guest' };
                Core.render();
            }
            Core.renderSettings();
        },

        save: () => {
            if(State.user) DB.ref('users/'+State.user).update(State.data);
            else localStorage.setItem('syl_local', JSON.stringify(State.data));
            Core.render();
        },

        render: () => {
            const d = State.data;
            const def = State.defaults;

            document.getElementById('home-user-title').innerText = d.user || 'Explorer';
            document.getElementById('pf-name').innerText = d.user || 'Guest User';
            document.getElementById('pf-bnr').src = d.bnr || def.bnr;
            document.getElementById('pf-pfp').src = d.pfp || (def.pfp + (d.user||'G'));
            
            document.getElementById('stat-tables').innerText = (d.subjects||[]).length;
            document.getElementById('stat-fam').innerText = (d.family||[]).length;

            const list = document.getElementById('list-subjects');
            if(!d.subjects || !d.subjects.length) {
                list.innerHTML = `<div class="empty-state">No tables created yet.</div>`;
            } else {
                list.innerHTML = d.subjects.map((s, i) => `
                    <div class="card card-press" onclick="Core.openSub(${i})">
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <div>
                                <b style="font-size:18px;">${s.name}</b>
                                <p style="font-size:13px; margin-top:4px;">${(s.tasks||[]).length} Goals defined</p>
                            </div>
                            <div style="color:var(--primary)">
                                <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path d="M9 5l7 7-7 7"></path></svg>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
        },

        // --- IMPROVED FIREBASE SEARCH ---
        search: async (q) => {
            const resBox = document.getElementById('list-results');
            if(!q || q.length < 2) {
                resBox.innerHTML = `<div class="empty-state">Keep typing...</div>`;
                return;
            }

            // Real-time query to Firebase
            DB.ref('users').orderByChild('user')
              .startAt(q).endAt(q + "\uf8ff")
              .once('value', snap => {
                let html = "";
                snap.forEach(child => {
                    const u = child.val();
                    html += `
                        <div class="card card-press" onclick="Core.viewPublic('${u.user}')">
                            <div style="display:flex; align-items:center; gap:15px;">
                                <img src="${u.pfp || State.defaults.pfp + u.user}" style="width:45px; height:45px; border-radius:12px;">
                                <div>
                                    <b style="display:block;">${u.user}</b>
                                    <small style="color:var(--text-sec)">${(u.subjects||[]).length} Tables</small>
                                </div>
                            </div>
                        </div>`;
                });
                resBox.innerHTML = html || `<div class="empty-state">No users found matching "${q}"</div>`;
            });
        },

        openSub: (i) => {
            State.curSubIdx = i;
            const sub = State.data.subjects[i];
            document.getElementById('dt-title').innerText = sub.name;
            document.getElementById('dt-desc').innerText = (sub.tasks||[]).length + " active goals in this table";
            
            const taskList = document.getElementById('list-tasks');
            taskList.innerHTML = (sub.tasks && sub.tasks.length) ? sub.tasks.map(t => `
                <div class="card" style="border-left: 4px solid var(--primary)">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <b>${t.desc}</b>
                        <span class="badge" style="background:rgba(255,255,255,0.05)">${t.date || 'No Date'}</span>
                    </div>
                </div>
            `).join('') : `<div class="empty-state">No goals yet.</div>`;
            Router.go('detail');
        },

        login: async () => {
            const u = document.getElementById('au-u').value.trim();
            const p = document.getElementById('au-p').value.trim();
            const snap = await DB.ref('users/'+u).once('value');
            if(snap.exists() && snap.val().pass === p) {
                localStorage.setItem('syl_u', u);
                localStorage.setItem('syl_p', p);
                location.reload();
            } else Toast.show("Wrong username or password");
        },

        signup: async () => {
            const u = document.getElementById('au-u').value.trim();
            const p = document.getElementById('au-p').value.trim();
            if(u.length < 3) return Toast.show("Username too short");
            const snap = await DB.ref('users/'+u).once('value');
            if(snap.exists()) return Toast.show("Username taken");

            const newData = {...State.data, user: u, pass: p, subjects: State.data.subjects || []};
            await DB.ref('users/'+u).set(newData);
            localStorage.setItem('syl_u', u);
            localStorage.setItem('syl_p', p);
            location.reload();
        },

        renderSettings: () => {
            const el = document.getElementById('auth-section');
            if(State.user) {
                el.innerHTML = `<div class="card">
                    <p style="margin-bottom:10px;">Logged in as <b>${State.user}</b></p>
                    <button class="btn btn-sec" style="color:var(--danger)" onclick="localStorage.clear();location.reload()">Sign Out</button>
                </div>`;
            } else {
                el.innerHTML = `
                <div class="card">
                    <h3 style="margin-top:0">Cloud Sync</h3>
                    <input id="au-u" class="inp" placeholder="Username" style="margin-bottom:12px;">
                    <input id="au-p" class="inp" type="password" placeholder="Password" style="margin-bottom:20px;">
                    <div style="display:flex; gap:10px;">
                        <button class="btn" onclick="Core.login()">Login</button>
                        <button class="btn btn-sec" onclick="Core.signup()">Register</button>
                    </div>
                </div>`;
            }
        },

        upload: (t) => { if(State.user) { State.upType=t; document.getElementById('f-upl').click(); } else Toast.show("Log in to customize"); },
        processUpload: (e) => {
            const r = new FileReader();
            r.onload = (ev) => { State.data[State.upType] = ev.target.result; Core.save(); };
            r.readAsDataURL(e.files[0]);
        }
    };

    const Modals = {
        addSubject: () => {
            document.getElementById('m-title').innerText = "Create Table";
            document.getElementById('m-body').innerHTML = `<input id="m-inp" class="inp" placeholder="e.g. Computer Science S1">`;
            document.getElementById('modal-overlay').style.display = 'flex';
            document.getElementById('m-btn-ok').onclick = () => {
                const val = document.getElementById('m-inp').value;
                if(val) {
                    if(!State.data.subjects) State.data.subjects = [];
                    State.data.subjects.push({name: val, tasks: []});
                    Core.save(); Modals.close();
                }
            };
        },
        addTask: () => {
            document.getElementById('m-title').innerText = "Add Goal";
            document.getElementById('m-body').innerHTML = `
                <input id="m-inp" class="inp" placeholder="Task description...">
                <input id="m-date" type="date" class="inp" style="margin-top:12px;">`;
            document.getElementById('modal-overlay').style.display = 'flex';
            document.getElementById('m-btn-ok').onclick = () => {
                const t = document.getElementById('m-inp').value;
                const d = document.getElementById('m-date').value;
                if(t) {
                    if(!State.data.subjects[State.curSubIdx].tasks) State.data.subjects[State.curSubIdx].tasks = [];
                    State.data.subjects[State.curSubIdx].tasks.push({desc: t, date: d});
                    Core.save(); Core.openSub(State.curSubIdx); Modals.close();
                }
            };
        },
        close: () => document.getElementById('modal-overlay').style.display = 'none'
    };

    const Toast = { show: (msg) => { const t=document.getElementById('toast'); t.innerText=msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),3000); } };

    window.onload = Core.init;
</script>
</body>
</html>
