<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SyllabusStudy Luminous</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <style>
        /* --- SYSTEM VARIABLES --- */
        :root {
            --primary: #0A84FF;
            --danger: #FF453A;
            --success: #32D74B;
            --bg: #000000;
            --card: rgba(30, 30, 32, 0.7);
            --glass: rgba(255, 255, 255, 0.1);
            --border: rgba(255, 255, 255, 0.15);
            --text: #ffffff;
            --subtext: rgba(255, 255, 255, 0.55);
        }

        /* --- GLOBAL RESET & TYPOGRAPHY --- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; user-select: none; }
        body, html { margin: 0; padding: 0; background: var(--bg); color: var(--text); font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif; height: 100vh; overflow: hidden; }

        /* --- ANIMATED WALLPAPER --- */
        .wallpaper {
            position: fixed; inset: 0; z-index: -1;
            background: radial-gradient(circle at 50% 10%, #2c1e4a, #000 60%);
            animation: pulseBg 10s infinite alternate;
        }
        @keyframes pulseBg { 0% { opacity: 0.8; transform: scale(1); } 100% { opacity: 1; transform: scale(1.1); } }

        /* --- SCREEN TRANSITIONS --- */
        .screen {
            position: absolute; inset: 0;
            padding: 80px 24px 120px;
            opacity: 0; pointer-events: none;
            transform: scale(0.95) translateY(10px);
            transition: all 0.5s cubic-bezier(0.2, 0.8, 0.2, 1);
            overflow-y: auto;
            scrollbar-width: none;
        }
        .screen::-webkit-scrollbar { display: none; }
        
        .screen.active {
            opacity: 1; pointer-events: auto;
            transform: scale(1) translateY(0);
        }

        /* --- STAGGERED LIST ANIMATION --- */
        @keyframes slideUpFade {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .anim-item { animation: slideUpFade 0.4s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; opacity: 0; }
        .anim-item:nth-child(1) { animation-delay: 0.05s; }
        .anim-item:nth-child(2) { animation-delay: 0.1s; }
        .anim-item:nth-child(3) { animation-delay: 0.15s; }
        .anim-item:nth-child(4) { animation-delay: 0.2s; }
        .anim-item:nth-child(5) { animation-delay: 0.25s; }

        /* --- COMPONENT: GLASS CARD --- */
        .card {
            background: var(--card);
            backdrop-filter: blur(25px) saturate(180%);
            -webkit-backdrop-filter: blur(25px) saturate(180%);
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 22px;
            margin-bottom: 16px;
            position: relative;
            transition: transform 0.2s;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }
        .card:active { transform: scale(0.97); }

        /* --- COMPONENT: BUTTONS --- */
        .btn {
            width: 100%; padding: 18px;
            border-radius: 20px; border: none;
            font-size: 16px; font-weight: 700;
            cursor: pointer; text-align: center;
            transition: 0.3s; margin-top: 12px;
            display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .btn:active { transform: scale(0.95); opacity: 0.8; }
        .btn-primary { background: white; color: black; box-shadow: 0 4px 15px rgba(255,255,255,0.2); }
        .btn-glass { background: var(--glass); color: white; border: 1px solid var(--border); }
        .btn-danger { background: rgba(255, 69, 58, 0.15); color: var(--danger); border: 1px solid rgba(255, 69, 58, 0.3); }

        /* --- COMPONENT: INPUTS --- */
        .inp {
            width: 100%; padding: 18px;
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border);
            border-radius: 18px;
            color: white; font-size: 16px;
            margin-bottom: 12px;
            transition: 0.3s;
        }
        .inp:focus { border-color: var(--primary); background: rgba(0,0,0,0.5); }

        /* --- PROFILE UI --- */
        .banner-wrap {
            height: 180px; width: 100%;
            border-radius: 30px; overflow: hidden;
            position: relative; border: 1px solid var(--border);
            transition: 0.3s;
        }
        .banner-wrap img { width: 100%; height: 100%; object-fit: cover; }
        .pfp-wrap {
            width: 100px; height: 100px;
            border-radius: 30px; border: 6px solid #1c1c1e;
            background: #2c2c2e; overflow: hidden;
            margin-top: -50px; margin-left: 24px;
            position: relative; z-index: 10;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
            transition: 0.3s;
        }
        .pfp-wrap img { width: 100%; height: 100%; object-fit: cover; }

        .role-tag {
            display: inline-block; padding: 6px 12px;
            border-radius: 10px; font-size: 11px; font-weight: 800;
            text-transform: uppercase; letter-spacing: 1px;
            margin-top: 8px;
        }
        .tag-admin { background: var(--danger); box-shadow: 0 0 15px rgba(255,69,58,0.4); }
        .tag-user { background: var(--primary); }

        /* --- BOTTOM DOCK --- */
        .dock {
            position: fixed; bottom: 24px; left: 24px; right: 24px;
            height: 80px;
            background: rgba(22, 22, 24, 0.85);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            border-radius: 35px;
            border: 1px solid var(--border);
            display: flex; justify-content: space-around; align-items: center;
            z-index: 100;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        .dock-item {
            flex: 1; display: flex; flex-direction: column; align-items: center; gap: 5px;
            opacity: 0.4; transition: 0.3s; cursor: pointer;
        }
        .dock-item.active { opacity: 1; transform: translateY(-5px); }
        .dock-icon { font-size: 24px; filter: drop-shadow(0 0 10px var(--primary)); }
        .dock-label { font-size: 10px; font-weight: 700; }
        
        .notif-dot {
            width: 10px; height: 10px; background: var(--danger);
            border-radius: 50%; position: absolute; top: 18px; right: 25%;
            border: 2px solid #161618; transform: scale(0); transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .notif-active { transform: scale(1); }

        /* --- MODAL SYSTEM --- */
        .modal-overlay {
            position: fixed; inset: 0;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(20px);
            z-index: 2000;
            display: flex; align-items: center; justify-content: center;
            opacity: 0; pointer-events: none;
            transition: 0.3s;
        }
        .modal-overlay.open { opacity: 1; pointer-events: auto; }
        
        .modal-box {
            width: 85%; max-width: 400px;
            background: #1c1c1e;
            border: 1px solid var(--border);
            border-radius: 35px;
            padding: 30px;
            transform: scale(0.8);
            transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 30px 60px rgba(0,0,0,0.6);
        }
        .modal-overlay.open .modal-box { transform: scale(1); }

        /* HEADERS */
        h1 { margin: 0; font-size: 34px; font-weight: 900; letter-spacing: -1px; }
        h2 { margin: 0 0 10px 0; font-size: 28px; font-weight: 800; }
        .back-btn { opacity: 0.6; font-weight: 600; font-size: 14px; margin-bottom: 20px; display: inline-flex; align-items: center; gap: 8px; cursor: pointer; }

    </style>
</head>
<body>

    <div class="wallpaper"></div>

    <div id="scr-home" class="screen active">
        <h1>My Tables</h1>
        <p style="color:var(--subtext); margin-bottom: 30px;">Manage your study goals.</p>
        <div id="list-subjects"></div>
        <button class="btn btn-primary" onclick="GUI.open('new-subject')">
            <span>+</span> Create Table
        </button>
    </div>

    <div id="scr-detail" class="screen">
        <div class="back-btn" onclick="UI.nav('home')">‚Üê Back to Tables</div>
        <div class="card" style="background: linear-gradient(135deg, var(--primary), #005ecb); border:none;">
            <h2 id="dt-title">Mathematics</h2>
            <div id="dt-meta" style="opacity:0.8; font-size:13px;">0 Active Goals</div>
        </div>
        <div id="list-tasks" style="margin-top: 25px;"></div>
        <button class="btn btn-primary" onclick="GUI.open('new-task')">Add Goal</button>
    </div>

    <div id="scr-search" class="screen">
        <h1>Global Search</h1>
        <p style="color:var(--subtext); margin-bottom: 20px;">Find students and family.</p>
        <input type="text" class="inp" placeholder="Search Username..." oninput="Core.search(this.value)">
        <div id="list-search"></div>
    </div>

    <div id="scr-msgs" class="screen">
        <h1>Inbox</h1>
        <p style="color:var(--subtext); margin-bottom: 30px;">Family requests & updates.</p>
        <div id="list-msgs"></div>
    </div>

    <div id="scr-profile" class="screen" style="padding-top: 0;">
        <div class="banner-wrap" onclick="Core.triggerUpload('bnr')">
            <img id="pf-bnr" src="">
        </div>
        <div class="pfp-wrap" onclick="Core.triggerUpload('pfp')">
            <img id="pf-pfp" src="">
        </div>
        
        <div style="padding: 20px;">
            <h1 id="pf-name">Guest</h1>
            <span id="pf-badge" class="role-tag tag-user">Visitor</span>

            <div id="ctrl-guest" style="margin-top: 40px;">
                <div class="card">
                    <h3>Sync Account</h3>
                    <p style="color:var(--subtext); font-size:14px; line-height:1.5;">Create an account to enable Admin features, Search, and Family connections.</p>
                </div>
                <button class="btn btn-primary" onclick="GUI.open('signup')">Create Account</button>
                <button class="btn btn-glass" onclick="GUI.open('login')">Log In</button>
            </div>

            <div id="ctrl-user" style="display: none; margin-top: 40px;">
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px; margin-bottom:20px;">
                    <div class="card" style="text-align:center; padding:15px;">
                        <b id="stat-tables" style="font-size:24px;">0</b><br><small style="opacity:0.5">Tables</small>
                    </div>
                    <div class="card" style="text-align:center; padding:15px;">
                        <b id="stat-fam" style="font-size:24px;">0</b><br><small style="opacity:0.5">Family</small>
                    </div>
                </div>
                <button class="btn btn-danger" onclick="Core.logout()">Log Out</button>
            </div>
        </div>
    </div>

    <div id="scr-public" class="screen" style="padding-top: 0;">
        <div onclick="UI.nav('search')" style="position:absolute; top:30px; left:20px; z-index:50; background:rgba(0,0,0,0.6); backdrop-filter:blur(10px); padding:8px 16px; border-radius:20px; font-weight:bold; font-size:12px;">‚Üê Return</div>
        
        <div class="banner-wrap"><img id="pub-bnr" src=""></div>
        <div class="pfp-wrap"><img id="pub-pfp" src=""></div>
        
        <div style="padding: 20px;">
            <h1 id="pub-name">User</h1>
            <div style="margin-top: 30px;">
                <h4 style="opacity:0.5; text-transform:uppercase; font-size:12px; letter-spacing:1px; margin-bottom:15px;">Public Tables</h4>
                <div id="pub-list"></div>
            </div>

            <div id="admin-panel" style="display:none; margin-top: 50px; padding-top: 20px; border-top: 1px solid var(--border);">
                <div style="display:flex; align-items:center; gap:10px; color:var(--danger); margin-bottom:10px;">
                    <span style="font-size:20px;">‚ö†Ô∏è</span> <b>ADMIN ACCESS</b>
                </div>
                <p style="font-size:13px; opacity:0.6;">You have elevated privileges. You can permanently delete this user.</p>
                <button class="btn btn-danger" onclick="Core.adminDelete()">DELETE USER</button>
            </div>
        </div>
    </div>

    <div id="modal-overlay" class="modal-overlay">
        <div class="modal-box">
            <h2 id="m-title">Title</h2>
            <div id="m-content"></div>
            <div id="m-actions" style="margin-top: 20px;"></div>
        </div>
    </div>

    <input type="file" id="file-up" style="display:none" onchange="Core.processUpload(this)">

    <div class="dock">
        <div class="dock-item active" onclick="UI.nav('home', this)">
            <span class="dock-icon">üìö</span>
            <span class="dock-label">Tables</span>
        </div>
        <div class="dock-item" onclick="UI.nav('search', this)">
            <span class="dock-icon">üîç</span>
            <span class="dock-label">Search</span>
        </div>
        <div class="dock-item" onclick="UI.nav('msgs', this)">
            <div id="badge-msg" class="notif-dot"></div>
            <span class="dock-icon">üí¨</span>
            <span class="dock-label">Inbox</span>
        </div>
        <div class="dock-item" onclick="UI.nav('profile', this)">
            <span class="dock-icon">üë§</span>
            <span class="dock-label">Profile</span>
        </div>
    </div>

<script>
    // --- 1. FIREBASE CONFIGURATION ---
    const firebaseConfig = {
      apiKey: "AIzaSyC2ryrcM8eRTUIkBrVitQUWn2x5oTbbnmE",
      authDomain: "syllabuspro-4ec5c.firebaseapp.com",
      projectId: "syllabuspro-4ec5c",
      databaseURL: "https://syllabuspro-4ec5c-default-rtdb.asia-southeast1.firebasedatabase.app/",
      storageBucket: "syllabuspro-4ec5c.firebasestorage.app"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // --- 2. STATE MANAGEMENT ---
    let State = {
        user: localStorage.getItem('sb_user'),
        pass: localStorage.getItem('sb_pass'),
        data: null,      // Current user data
        viewUser: null,  // User being viewed in public profile
        activeSub: 0,    // Active subject index
        uploadType: null // 'bnr' or 'pfp'
    };

    // --- 3. UI ANIMATION ENGINE ---
    const UI = {
        nav(screenId, dockEl) {
            // Screen Transition
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('scr-' + screenId).classList.add('active');
            
            // Dock Animation
            if(dockEl) {
                document.querySelectorAll('.dock-item').forEach(d => d.classList.remove('active'));
                dockEl.classList.add('active');
            }
        },
        renderList(containerId, items, renderFn, emptyMsg = "Nothing here yet.") {
            const cont = document.getElementById(containerId);
            if (!items || items.length === 0) {
                cont.innerHTML = `<div class="anim-item" style="text-align:center; opacity:0.4; padding:20px;">${emptyMsg}</div>`;
                return;
            }
            // Generate HTML with staggered animation classes
            cont.innerHTML = items.map((item, index) => {
                // Determine delay dynamically
                const delay = (index * 0.05) + 's';
                return `<div class="anim-item" style="animation-delay:${delay}">${renderFn(item, index)}</div>`;
            }).join('');
        }
    };

    // --- 4. MODAL GUI ENGINE ---
    const GUI = {
        open(type) {
            const ov = document.getElementById('modal-overlay');
            const tit = document.getElementById('m-title');
            const con = document.getElementById('m-content');
            const act = document.getElementById('m-actions');
            
            ov.classList.add('open');
            tit.innerText = ""; con.innerHTML = ""; act.innerHTML = "";

            // --- BUILD MODAL CONTENT BASED ON TYPE ---
            if (type === 'login' || type === 'signup') {
                tit.innerText = type === 'login' ? "Welcome Back" : "Join Us";
                con.innerHTML = `
                    <input id="auth-u" class="inp" placeholder="Username (e.g. Admin)">
                    <input id="auth-p" type="password" class="inp" placeholder="Password">
                `;
                act.innerHTML = `
                    <button class="btn btn-primary" onclick="Core.auth('${type}')">
                        ${type === 'login' ? 'Sign In' : 'Create Account'}
                    </button>
                    <button class="btn btn-glass" onclick="GUI.close()">Cancel</button>
                `;
            } 
            else if (type === 'new-subject') {
                if(!State.user) return GUI.open('signup');
                tit.innerText = "New Table";
                con.innerHTML = `<input id="sub-name" class="inp" placeholder="Subject Name (e.g. Physics)">`;
                act.innerHTML = `<button class="btn btn-primary" onclick="Core.addSub()">Create Table</button><button class="btn btn-glass" onclick="GUI.close()">Cancel</button>`;
            }
            else if (type === 'new-task') {
                tit.innerText = "New Goal";
                con.innerHTML = `
                    <input id="task-desc" class="inp" placeholder="Goal Description">
                    <input id="task-date" type="date" class="inp">
                `;
                act.innerHTML = `<button class="btn btn-primary" onclick="Core.addTask()">Add Goal</button><button class="btn btn-glass" onclick="GUI.close()">Cancel</button>`;
            }
        },
        close() {
            document.getElementById('modal-overlay').classList.remove('open');
        }
    };

    // --- 5. CORE LOGIC & DATABASE ---
    const Core = {
        async auth(mode) {
            const u = document.getElementById('auth-u').value.trim(); // No lowercase forcing, allow 'Admin'
            const p = document.getElementById('auth-p').value;
            if(!u || !p) return;

            const ref = db.ref('users/' + u);
            const snap = await ref.once('value');

            if(mode === 'login') {
                if(snap.exists() && snap.val().pass === p) {
                    localStorage.setItem('sb_user', u);
                    localStorage.setItem('sb_pass', p);
                    location.reload();
                } else {
                    alert("Invalid Credentials");
                }
            } else {
                if(snap.exists()) return alert("Username taken");
                await ref.set({
                    user: u, pass: p, subjects: [], invites: [], family: [],
                    pfp: "", bnr: ""
                });
                localStorage.setItem('sb_user', u);
                localStorage.setItem('sb_pass', p);
                location.reload();
            }
        },
        async search(query) {
            if(!query) { document.getElementById('list-search').innerHTML = ""; return; }
            const snap = await db.ref('users').once('value');
            const results = [];
            snap.forEach(child => {
                const u = child.val();
                if(u.user && u.user.toLowerCase().includes(query.toLowerCase())) {
                    results.push(u);
                }
            });

            UI.renderList('list-search', results, (u) => `
                <div class="card" onclick="Core.viewPublicProfile('${u.user}')">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <div style="display:flex; align-items:center; gap:12px;">
                            <img src="${u.pfp || 'https://api.dicebear.com/7.x/initials/svg?seed='+u.user}" style="width:40px; height:40px; border-radius:12px;">
                            <b>${u.user}</b>
                        </div>
                        ${State.user && u.user !== State.user ? `
                        <button class="btn btn-glass" style="width:auto; padding:8px 16px; margin:0; font-size:12px;" onclick="event.stopPropagation(); Core.sendInvite('${u.user}')">INVITE</button>
                        ` : ''}
                    </div>
                </div>
            `, "No users found.");
        },
        async viewPublicProfile(targetUser) {
            State.viewUser = targetUser;
            const snap = await db.ref('users/'+targetUser).once('value');
            if(!snap.exists()) return;
            const d = snap.val();

            // Render Public Data
            document.getElementById('pub-name').innerText = d.user;
            document.getElementById('pub-pfp').src = d.pfp || 'https://api.dicebear.com/7.x/initials/svg?seed='+d.user;
            document.getElementById('pub-bnr').src = d.bnr || 'https://images.unsplash.com/photo-1550684848-fac1c5b4e853?w=800';
            
            UI.renderList('pub-list', d.subjects || [], (sub) => `
                <div class="card" style="opacity:0.8">
                    <b>${sub.name}</b>
                    <div style="font-size:12px; opacity:0.5; margin-top:5px;">${(sub.tasks||[]).length} Goals</div>
                </div>
            `, "This user has no public tables.");

            // ADMIN LOGIC CHECK
            const panel = document.getElementById('admin-panel');
            if (State.user === 'Admin' && targetUser !== 'Admin') {
                panel.style.display = 'block';
            } else {
                panel.style.display = 'none';
            }

            UI.nav('public');
        },
        async adminDelete() {
            if(!confirm(`ADMIN CONFIRMATION:\nAre you sure you want to completely erase user "${State.viewUser}" from the database?`)) return;
            await db.ref('users/'+State.viewUser).remove();
            alert("User deleted successfully.");
            UI.nav('search');
        },
        async sendInvite(target) {
            const ref = db.ref('users/'+target+'/invites');
            const snap = await ref.once('value');
            let invs = snap.val() || [];
            if(!invs.includes(State.user)) {
                invs.push(State.user);
                await ref.set(invs);
                alert("Invitation Sent!");
            } else {
                alert("Already invited.");
            }
        },
        async handleInvite(sender, accept) {
            // Remove from invites
            let newInvites = (State.data.invites || []).filter(i => i !== sender);
            
            if(accept) {
                // Add to family
                let fam = State.data.family || [];
                fam.push(sender);
                await db.ref('users/'+State.user).update({family: fam});
                
                // Add me to sender's family (bidirectional)
                const sRef = db.ref('users/'+sender+'/family');
                const sSnap = await sRef.once('value');
                let sFam = sSnap.val() || [];
                sFam.push(State.user);
                await sRef.set(sFam);
            }
            await db.ref('users/'+State.user).update({invites: newInvites});
        },
        triggerUpload(type) {
            if(!State.user) return GUI.open('signup');
            State.uploadType = type;
            document.getElementById('file-up').click();
        },
        processUpload(el) {
            if(!el.files[0]) return;
            const reader = new FileReader();
            reader.onload = async (e) => {
                await db.ref('users/'+State.user).update({ [State.uploadType]: e.target.result });
            };
            reader.readAsDataURL(el.files[0]);
        },
        addSub() {
            const name = document.getElementById('sub-name').value;
            if(!name) return;
            let subs = State.data.subjects || [];
            subs.push({ name: name, tasks: [] });
            db.ref('users/'+State.user).update({subjects: subs}).then(() => GUI.close());
        },
        openSub(index) {
            State.activeSub = index;
            const sub = State.data.subjects[index];
            document.getElementById('dt-title').innerText = sub.name;
            document.getElementById('dt-meta').innerText = (sub.tasks || []).length + " Goals";
            
            UI.renderList('list-tasks', sub.tasks || [], (t) => `
                <div class="card">
                    <div style="font-weight:600; font-size:16px;">${t.desc}</div>
                    <div style="font-size:12px; color:var(--primary); margin-top:6px;">üìÖ Due: ${t.date}</div>
                </div>
            `, "No goals set yet.");
            
            UI.nav('detail');
        },
        addTask() {
            const d = document.getElementById('task-desc').value;
            const date = document.getElementById('task-date').value;
            if(!d || !date) return;
            
            let subs = State.data.subjects;
            subs[State.activeSub].tasks = subs[State.activeSub].tasks || [];
            subs[State.activeSub].tasks.push({ desc: d, date: date });
            
            db.ref('users/'+State.user).update({subjects: subs}).then(() => {
                GUI.close();
                Core.openSub(State.activeSub); // Refresh detail view
            });
        },
        logout() {
            localStorage.clear();
            location.reload();
        }
    };

    // --- 6. INITIALIZATION & LISTENER ---
    window.onload = () => {
        if(State.user) {
            // Logged In State
            document.getElementById('ctrl-guest').style.display = 'none';
            document.getElementById('ctrl-user').style.display = 'block';

            // Real-time Listener
            db.ref('users/' + State.user).on('value', snap => {
                const d = snap.val();
                if(!d) return;
                State.data = d;

                // Update Profile UI
                document.getElementById('pf-name').innerText = d.user;
                document.getElementById('pf-bnr').src = d.bnr || 'https://images.unsplash.com/photo-1550684848-fac1c5b4e853?w=800';
                document.getElementById('pf-pfp').src = d.pfp || 'https://api.dicebear.com/7.x/initials/svg?seed='+d.user;
                document.getElementById('stat-tables').innerText = (d.subjects||[]).length;
                document.getElementById('stat-fam').innerText = (d.family||[]).length;

                // Admin Badge Check
                if(d.user === "Admin") {
                    const tag = document.getElementById('pf-badge');
                    tag.innerText = "ADMIN";
                    tag.className = "role-tag tag-admin";
                }

                // Render Subjects (Home)
                UI.renderList('list-subjects', d.subjects || [], (s, i) => `
                    <div class="card" onclick="Core.openSub(${i})">
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <b>${s.name}</b>
                            <span style="opacity:0.3">‚ûî</span>
                        </div>
                        <div style="font-size:12px; margin-top:8px; opacity:0.6;">${(s.tasks||[]).length} Goals active</div>
                    </div>
                `, "Create your first table to get started.");

                // Render Messages
                const invites = d.invites || [];
                const badge = document.getElementById('badge-msg');
                if(invites.length > 0) badge.classList.add('notif-active');
                else badge.classList.remove('notif-active');

                UI.renderList('list-msgs', invites, (inv) => `
                    <div class="card">
                        <div style="margin-bottom:12px;"><b>${inv}</b> wants to join your family.</div>
                        <div style="display:flex; gap:10px;">
                            <button class="btn btn-primary" style="margin:0; padding:10px; font-size:14px;" onclick="Core.handleInvite('${inv}', true)">Accept</button>
                            <button class="btn btn-glass" style="margin:0; padding:10px; font-size:14px;" onclick="Core.handleInvite('${inv}', false)">Ignore</button>
                        </div>
                    </div>
                `, "No new messages.");
            });
        } else {
            // Guest State Default Images
            document.getElementById('pf-bnr').src = 'https://images.unsplash.com/photo-1550684848-fac1c5b4e853?w=800';
            document.getElementById('pf-pfp').src = 'https://api.dicebear.com/7.x/shapes/svg?seed=Guest';
            UI.renderList('list-subjects', [], null, "Please Log In to create tables.");
        }
    };
</script>
</body>
</html>
